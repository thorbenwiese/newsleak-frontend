<script src="{{ site.url }}/assets/js/javascript.min.js"></script>

<script>
    var repoData = {};

    $("github-downloads").each(function(index) {
        var node       = $(this);
    	
    	var url = "https://api.github.com/repos/"+node.attr("user")+"/"+node.attr("repo")+"/releases";

    	var showStats = function(data) {
    		repoData[node.attr("user")+"/"+node.attr("repo")] = data;
    		
		    var err = false;
		    var errMessage = "";
		
		    if(data.status == 404) {
		        err = true;
		        errMessage = "The project does not exist!";
		    }
		
		    if(data.length == 0) {
		        err = true;
		        errMessage = "There are no releases for this project";
		    }
		
		    var html = "";
		    
		    if (err) {
		        html = errMessage;
		    } else {    		
		    	$.each(data, function(release_index, release) {
		    		if (release.tag_name == node.attr("tag")) {
		    			$.each(release.assets, function(asset_index, asset) {
		    			    if (asset.name == node.attr("asset")) {
		    			        if (asset.download_count > 25) {
		    				        html = "(Downloads: "+(asset.download_count ? asset.download_count : "0")+")";
		    			        }
		    			        else {
		    			            html = " ";
		    			        }
		    			    }	
		    			});
		    		}
		    	});
		    	
		    	if (html == "") {
		    		html = "Release "+node.attr("tag")+" or asset "+node.attr("asset")+" not found.";
		    	}
		    }
		    
            node.replaceWith(html);
    	};
    	
    	if (typeof repoData[node.attr("user")+"/"+node.attr("repo")] === "undefined") {
    	   $.getJSON(url, showStats).fail(showStats);
        }
    	else {
    		showStats(repoData[node.attr("user")+"/"+node.attr("repo")]);
    	}
    })
</script>

{% if page.header.image_fullwidth %}
<script>
    $("#masthead").backstretch("{{ site.url }}/images/{{ page.header.image_fullwidth }}", {fade: 700});
    $("#masthead-with-text").backstretch("{{ site.url }}/images/{{ page.header.image_fullwidth }}", {fade: 700});
</script>
{% endif %}



{% if site.google_analytics_tracking_id %}
<script>
  var gaProperty = '{{ site.google_analytics_tracking_id }}';

  /* Disable tracking if the opt-out cookie exists. */
  var disableStr = 'ga-disable-' + gaProperty;
  if (document.cookie.indexOf(disableStr + '=true') > -1) {
    window[disableStr] = true;
  }

  /* Opt-out function */
  function gaOptout() {
    document.cookie = disableStr + '=true; expires=Thu, 31 Dec 2099 23:59:59 UTC; path=/';
    window[disableStr] = true;
  }

  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', '{{ site.google_analytics_tracking_id }}', 'auto');
  ga('set', 'anonymizeIp', true);
  ga('send', 'pageview');
</script>
{% endif %}
